{
  "entities": {
    "ServiceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceRecord",
      "type": "object",
      "description": "Represents a record of a service performed, including details about the customer, equipment, work done, and costs.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service record."
        },
        "date": {
          "type": "string",
          "description": "Date when the service was performed.",
          "format": "date-time"
        },
        "technicianId": {
          "type": "string",
          "description": "Reference to the Technician who performed the service. (Relationship: Technician 1:N ServiceRecord)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the Customer who received the service. (Relationship: Customer 1:N ServiceRecord)"
        },
        "address": {
          "type": "string",
          "description": "Address where the service was performed."
        },
        "phone": {
          "type": "string",
          "description": "Phone number associated with the service location."
        },
        "equipmentModel": {
          "type": "string",
          "description": "Model number of the equipment serviced."
        },
        "equipmentSerial": {
          "type": "string",
          "description": "Serial number of the equipment serviced."
        },
        "filterSize": {
          "type": "string",
          "description": "Size of the filter used, if applicable."
        },
        "freonType": {
          "type": "string",
          "description": "Type of freon used, if applicable."
        },
        "laborHours": {
          "type": "number",
          "description": "Number of labor hours spent on the service."
        },
        "workDescription": {
          "type": "string",
          "description": "Detailed description of the work performed."
        },
        "totalCost": {
          "type": "number",
          "description": "Total cost of the service."
        },
        "status": {
          "type": "string",
          "description": "Status of the service record (e.g., 'Owed', 'Paid', 'Estimate')."
        },
        "fileLink": {
          "type": "string",
          "description": "Link to the original document file.",
          "format": "uri"
        },
        "page": {
          "type": "number",
          "description": "Page number in the original document where the service record is found."
        },
        "recordSummary": {
          "type": "string",
          "description": "A summarized description of the service record, generated by AI."
        }
      },
      "required": [
        "id",
        "date",
        "technicianId",
        "customerId",
        "address",
        "phone",
        "equipmentModel",
        "equipmentSerial",
        "laborHours",
        "workDescription",
        "totalCost",
        "status"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who receives services.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "name": {
          "type": "string",
          "description": "Name of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email of the customer.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "phone"
      ]
    },
    "Technician": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Technician",
      "type": "object",
      "description": "Represents a technician who performs services.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the technician."
        },
        "name": {
          "type": "string",
          "description": "Name of the technician."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the technician."
        },
        "email": {
          "type": "string",
          "description": "Email of the technician.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Todo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Todo",
      "type": "object",
      "description": "Represents a to-do item for a technician.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the to-do item." },
        "task": { "type": "string", "description": "The description of the task." },
        "isCompleted": { "type": "boolean", "description": "Whether the task is completed." },
        "createdAt": { "type": "string", "format": "date-time", "description": "The timestamp when the task was created." },
        "technicianId": { "type": "string", "description": "The ID of the technician this to-do belongs to." }
      },
      "required": ["id", "task", "isCompleted", "createdAt", "technicianId"]
    },
    "CalendarEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CalendarEvent",
      "type": "object",
      "description": "Represents an event on the technician's calendar.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the event." },
        "title": { "type": "string", "description": "The title of the event." },
        "start": { "type": "string", "format": "date-time", "description": "The start date and time of the event." },
        "end": { "type": "string", "format": "date-time", "description": "The end date and time of the event." },
        "description": { "type": "string", "description": "A description of the event." },
        "technicianId": { "type": "string", "description": "The ID of the technician this event belongs to." }
      },
      "required": ["id", "title", "start", "end", "technicianId"]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a business expense, such as a purchase for a job or general costs.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense record."
        },
        "date": {
          "type": "string",
          "description": "Date when the expense was incurred.",
          "format": "date-time"
        },
        "technicianId": {
          "type": "string",
          "description": "Reference to the Technician who incurred the expense."
        },
        "amount": {
          "type": "number",
          "description": "The total amount of the expense."
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        },
        "vendor": {
          "type": "string",
          "description": "The vendor or store where the purchase was made."
        },
        "receiptUrl": {
          "type": "string",
          "description": "Link to the uploaded receipt image.",
          "format": "uri"
        },
        "serviceRecordId": {
          "type": "string",
          "description": "Optional reference to a service record if the expense is for a specific job."
        }
      },
      "required": [ "id", "date", "technicianId", "amount", "description", "vendor", "receiptUrl" ]
    },
    "PriceBookEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PriceBookEntry",
      "type": "object",
      "description": "Represents a pricing document in the price book.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the price book entry." },
        "fileName": { "type": "string", "description": "The name of the uploaded file." },
        "fileUrl": { "type": "string", "format": "uri", "description": "The URL to the uploaded file in storage." },
        "uploadedAt": { "type": "string", "format": "date-time", "description": "The timestamp when the file was uploaded." },
        "technicianId": { "type": "string", "description": "The ID of the technician who uploaded the file." }
      },
      "required": ["id", "fileName", "fileUrl", "uploadedAt", "technicianId"]
    },
    "Quote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quote",
      "type": "object",
      "description": "Represents a job quote provided to a customer.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the quote." },
        "customerId": { "type": "string", "description": "ID of the associated customer." },
        "customerName": { "type": "string", "description": "Name of the customer." },
        "customerAddress": { "type": "string", "description": "Address of the customer." },
        "customerPhone": { "type": "string", "description": "Phone number of the customer." },
        "quotePrice": { "type": "number", "description": "The total quoted price for the job." },
        "validUntil": { "type": "string", "format": "date-time", "description": "The date the quote is valid until." },
        "scopeOfWork": { "type": "string", "description": "Detailed description of the work to be performed." },
        "laborRequired": { "type": "string", "description": "Description of the labor required." },
        "materialsNeeded": { "type": "string", "description": "List of materials that will be needed." },
        "status": { "type": "string", "enum": ["Draft", "Sent", "Accepted", "Declined"], "description": "The current status of the quote." },
        "createdAt": { "type": "string", "format": "date-time", "description": "The timestamp when the quote was created." },
        "technicianId": { "type": "string", "description": "The ID of the technician who created the quote." }
      },
      "required": ["id", "customerId", "customerName", "quotePrice", "validUntil", "scopeOfWork", "status", "createdAt", "technicianId"]
    }
  },
  "auth": {
    "providers": []
  },
  "firestore": {
    "structure": [
      {
        "path": "/technicians/{technicianId}",
        "definition": {
          "entityName": "Technician",
          "schema": {
            "$ref": "#/backend/entities/Technician"
          },
          "description": "Stores technician profiles. Technician can read their own profile data.",
          "params": [
            {
              "name": "technicianId",
              "description": "The unique identifier for the technician."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Customer can read their own profile data.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/technicians/{technicianId}/serviceRecords/{serviceRecordId}",
        "definition": {
          "entityName": "ServiceRecord",
          "schema": {
            "$ref": "#/backend/entities/ServiceRecord"
          },
          "description": "Stores service records associated with a technician. Includes denormalized 'technicianId' for authorization independence.",
          "params": [
            {
              "name": "technicianId",
              "description": "The unique identifier for the technician."
            },
            {
              "name": "serviceRecordId",
              "description": "The unique identifier for the service record."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/serviceRecords/{serviceRecordId}",
        "definition": {
          "entityName": "ServiceRecord",
          "schema": {
            "$ref": "#/backend/entities/ServiceRecord"
          },
          "description": "Stores service records associated with a customer. Includes denormalized 'customerId' for authorization independence.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "serviceRecordId",
              "description": "The unique identifier for the service record."
            }
          ]
        }
      },
      {
        "path": "/technicians/{technicianId}/todos/{todoId}",
        "definition": {
            "entityName": "Todo",
            "schema": { "$ref": "#/backend/entities/Todo" },
            "description": "Stores to-do items for a technician.",
            "params": [
                { "name": "technicianId", "description": "The unique identifier for the technician." },
                { "name": "todoId", "description": "The unique identifier for the to-do item." }
            ]
        }
      },
      {
          "path": "/technicians/{technicianId}/calendarEvents/{eventId}",
          "definition": {
              "entityName": "CalendarEvent",
              "schema": { "$ref": "#/backend/entities/CalendarEvent" },
              "description": "Stores calendar events for a technician.",
              "params": [
                  { "name": "technicianId", "description": "The unique identifier for the technician." },
                  { "name": "eventId", "description": "The unique identifier for the calendar event." }
              ]
          }
      },
      {
        "path": "/technicians/{technicianId}/expenses/{expenseId}",
        "definition": {
            "entityName": "Expense",
            "schema": { "$ref": "#/backend/entities/Expense" },
            "description": "Stores expense records for a technician.",
            "params": [
                { "name": "technicianId", "description": "The unique identifier for the technician." },
                { "name": "expenseId", "description": "The unique identifier for the expense record." }
            ]
        }
      },
      {
        "path": "/technicians/{technicianId}/priceBookEntries/{entryId}",
        "definition": {
            "entityName": "PriceBookEntry",
            "schema": { "$ref": "#/backend/entities/PriceBookEntry" },
            "description": "Stores price book entries for a technician.",
            "params": [
                { "name": "technicianId", "description": "The unique identifier for the technician." },
                { "name": "entryId", "description": "The unique identifier for the price book entry." }
            ]
        }
      },
      {
        "path": "/quotes/{quoteId}",
        "definition": {
          "entityName": "Quote",
          "schema": { "$ref": "#/backend/entities/Quote" },
          "description": "Stores all job quotes. Accessible by technicians.",
          "params": [
            { "name": "quoteId", "description": "The unique identifier for the quote." }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, adhering to the core design principles and strategy mandates. It prioritizes authorization independence through denormalization, ensuring that security rules can be simple and robust. The structure supports the required QAPs by segregating data with different access needs into separate collections.\n\nAuthorization Independence:\nServiceRecord subcollections under technician and customer will contain denormalized copies of technicianId and customerId in each document.\n\nQAPs:\nList operations are secured by the path-based ownership, allowing the list function to be performed without get() calls.\n\nEach collection is designed with a homogeneous security posture, making rules easier to understand and maintain. The use of explicit state modeling with the 'status' field ensures data clarity and predictability."
  }
}
